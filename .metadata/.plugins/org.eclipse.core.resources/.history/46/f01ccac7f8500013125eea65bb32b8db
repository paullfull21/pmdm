package com.dam.pmdm.mediplayerstreaming;

import java.io.IOException;

import android.app.Activity;
import android.app.ProgressDialog;
import android.media.AudioManager;
import android.media.MediaPlayer;
import android.media.MediaPlayer.OnCompletionListener;
import android.media.MediaPlayer.OnPreparedListener;
import android.os.Bundle;
import android.os.PowerManager;
import android.view.View;

public class MainActivity extends Activity implements OnPreparedListener,
		OnCompletionListener {

	private MediaPlayer mediaPlayer;
	private ProgressDialog progreso;

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);
	}

	// Método que se llama al pulsar el botón play
	public void buttonPlay(View view) throws IllegalArgumentException,
			SecurityException, IllegalStateException, IOException {

		String url = "http://www.sonidosmp3gratis.com/sounds/trompeta_1.mp3";
		mediaPlayer = new MediaPlayer();
		
		progreso = new ProgressDialog(MainActivity.this);
		
		// como tenemos implementado el método onPrepared en esta clase, ponemos this
		// como parámetro. Dicho método se invocará cuando la canción haya sido terminada
		// de cargar
		mediaPlayer.setOnPreparedListener(this);	 
		mediaPlayer.setOnCompletionListener(this);
		
		// Establecemos que el Stream en el que va a sonar en el teléfono es el Stream de
		// Música.
		mediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC);
		mediaPlayer.setDataSource(url);
		
		progreso.setTitle("Rocky BSO");
		progreso.setMessage("Cargando...");
		progreso.setProgressStyle(ProgressDialog.STYLE_SPINNER);
		//progreso.setProgressStyle(ProgressDialog.STYLE_HORIZONTAL);
		progreso.show();

		mediaPlayer.prepareAsync();
	}

	@Override
	public void onPrepared(MediaPlayer mp) {
		// Elimina de la interfaz de usuario el ProgessDialog
		progreso.dismiss();
		// Cuando acaba de cargar inicia la reproducción del audio
		mp.start();
	}

	@Override
	public void onCompletion(MediaPlayer mp) {
		// Cuando se acaba la reproducción ponemos a null el MediaPlayer
		// para evitar que se cree una instancia 
		mp = null;
	}

}
